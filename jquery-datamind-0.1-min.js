(function(a,b){function c(){this._data={};this._eventHandlers={}}function f(b){return b&&(a.browser.safari&&typeof b=="object"&&b.length||b.constructor&&b.constructor.toString().match(/\Array\(\)/))}function g(a,b,c){var d=a.slice((c||b)+1||a.length);a.length=b<0?a.length+b:b;return a.push.apply(a,d)}function h(b){var c=b[0];var d=Array.prototype.slice.call(b,1),e={events:{},target:null,data:{}},f=null;if(typeof c=="string"){switch(d.length){case 3:e.target=d[0];e.data=d[1];f=d[2];break;case 2:if(typeof d[0]=="string"){e.target=d[0]}else{e.data=d[0]}f=d[1];break;case 1:if(a.isFunction(d[0])){f=d[0]}else{e.target=d[0]}break}c=c.split(" ");for(var g=c.length-1;g>=0;--g){if(c[g]!=""){e.events[c[g].replace(/\./gi,"_")]=f}}}else{switch(d.length){case 2:e.target=d[0];e.data=d[1];break;case 1:if(typeof d[0]=="string"){e.target=d[0]}else{e.data=d[0]}break}var h={},i=null,j="",k=0;for(var g in c){i=g.replace(/\./gi,"_").split(" ");for(k=i.length-1;k>=0;--k){j=i[k];if(j!=""){h[j]=c[g]}}}e.events=h}return e}var d={name:null,creation:null,update:null,value:null,setValue:function(a,b,c){var d=this.value;this.value=a;this.update=new Date;if(!b){c.trigger({type:"changed",newValue:this.value,lateValue:d,datamind:{newValue:this.value,lateValue:d}})}return this}},e={setValue:function(a,b){this[0].setValue(a,b,this);return this},getValue:function(){return this[0].value},push:function(b){return a.datamind.push(this[0].name,b)}};a.extend(c.prototype,{_loopIndex:0,_stopLooping:100,_eventPrefix:"datamind_",log:function(){if(this.debug)console.log.apply("",arguments)},_launchEvent:function(b,c){var d=a.Event(b);d.datamind=c;a.event.trigger(d);return!d.isDefaultPrevented()},init:function(b){for(var c in b){if(c.indexOf(".")>-1){console.error('DataMind : Field can\'t contain "."');return}}var f=null,g=new Date,h=this;for(var i in b){f=a(a.extend({},d,{name:i,creation:g}));f=a.extend(f,e);f.on("changed",function(a){return function(b){var c=a+":changed";h._launchEvent(c,{lateValue:b.lateValue,newValue:b.newValue})}}(i));this._data[i]=f.setValue(b[i],true)}},set:function(c,f,g){g=g!=b&&g;if(typeof c=="string"){this._loopIndex++;if(this._loopIndex>this._stopLooping){console.error("DataMind : Infinite call of the set method ... (more than "+this._stopLooping+"). You might not set values in a datamind event.");return false}var h=new Date;var i=c in this._data,j="",k=null,l=null,m=this;if(!i){var l=a(a.extend({},d,{name:c,creation:h}));l=a.extend(l,e);l.on("changed",function(a){j=c+":changed";m._launchEvent(j,{lateValue:a.lateValue,newValue:a.newValue})});l.setValue(f,true);this._data[c]=l;if(c.indexOf(".")>-1){console.error('DataMind : Field can\'t contain "."');return false}if(!g){j=c+":created";this._launchEvent(j,{newValue:f})}}else{k=this._data[c];if(!g){j=c+":changing";if(!this._launchEvent(j,{lateValue:k.getValue(),newValue:f})){return false}}l=this._data[c];l.setValue(f,g)}}this._loopIndex=0;return true},_checkField:function(a){if(typeof a=="string"){if(a in this._data){return true}else{console.error("DataMind : The field ("+a+") doesn't exist");return false}}},_isArray:function(a){if(f(this._data[a])){return true}else{console.error("DataMind : The field ("+a+") is not an array");return false}},_indexExists:function(a,b){if(this._data[a].length>b){return true}else{console.error("DataMind : The index "+b+" doesn't belong to the array "+a+".");return false}},_isObject:function(a){if(typeof this._data[a]=="object"){return true}else{console.error("DataMind : The field ("+a+") is not an object");return false}},_keyExists:function(a,b){if(b in this._data[a]){return true}else{console.error("DataMind : The key "+b+" doesn't belong to the object "+a+".");return false}},_keyDoesNotExist:function(a,b){if(b in this._data[a]){console.error("DataMind : The key "+b+" already exists in the object "+a+".");return true}return false},getAll:function(){var a={};for(var b in this._data){a[b]=this._data[b].getValue()}return a},get:function(a){if(this._checkField(a)){return this._data[a]}return false},push:function(a,b){if(this._checkField(a)&&this._isArray(a)){var c=a+":add";this._launchEvent(c,{way:"push",newValue:b,index:this._data[a].length});this._data[a].push(b);return true}return false},unshift:function(a){if(this._checkField(a)&&this._isArray(a)){var b=a+":add";this._launchEvent(b,{way:"unshift",newValue:value,index:0});this._data[a].unshift(value);return true}return false},pop:function(a){if(this._checkField(a)&&this._isArray(a)){var b=a+":remove";this._launchEvent(b,{way:"pop",newValue:this._data[a].pop(),index:this._data[a].length-1});return true}return false},shift:function(a){if(this._checkField(a)&&this._isArray(a)){var b=a+":remove";this._launchEvent(b,{way:"shift",lateValue:this._data[a].shift(),index:0});return true}return false},removeAt:function(a,b){if(this._checkField(a)&&this._isArray(a)&&this._indexExists(a,b)){var c=a+":remove";this._launchEvent(c,{way:"removeat",lateValue:this._data[a][b],index:b});return g(this._data[a],b,b)}return false},getAt:function(a,b){if(this._checkField(a)&&this._isArray(a)&&this._indexExists(a,b)){return this._data[a][b]}return false},updateAt:function(a,b,c){if(this._checkField(a)&&this._isArray(a)&&this._indexExists(a,b)){var d=a+":update";this._launchEvent(d,{lateValue:this._data[a][b],newValue:c,index:b});this._data[a][b]=c;return true}return false},addItem:function(a,b,c){if(this._checkField(a)&&this._isObject(a)&&this._keyDoesNotExist(a,b)){var d=a+":add";this._launchEvent(d,{way:"additem",newValue:c});this._data[a][b]=c;return true}return false},removeItem:function(a,b){if(this._checkField(a)&&this._isObject(a)&&this._keyExists(a,b)){var c=a+":remove";this._launchEvent(c,{way:"removeitem",lateValue:this._data[a][b]});this._data[a][b]=null;delete this._data[a][b];return true}return false},getItem:function(a,b){if(this._checkField(a)&&this._isObject(a)&&this._keyExists(a,b)){return this._data[a][b]}return false}});a.datamind=new c;a.datamind.uuid=(new Date).getTime()})(jQuery)